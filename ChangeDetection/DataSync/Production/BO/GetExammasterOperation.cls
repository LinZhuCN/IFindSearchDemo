Class DataSync.Production.BO.GetExammasterOperation Extends Ens.BusinessOperation
{

Parameter ADAPTER = "EnsLib.SQL.OutboundAdapter";

Property Adapter As EnsLib.SQL.OutboundAdapter;

Parameter INVOCATION = "Queue";

Method GetExammaster(pInput As DataSync.Production.Message.AddEncounterRequest, Output pOutput As DataSync.Production.Message.GetExammasterResponse) As %Status
{
	Set qryString = "SELECT CONCLUSION,EXAM_ITEM_CODE,EXAM_ITEM_NAME,EXAM_PERFORMER_DTIME,PERFORMER_DEPT_NAME,PERFORMER_DOCTOR,REPORT_FORM_NO,REPORT_TITLE from INSPUR_JKS_TJ.EXAMMASTER"
	_" where ORG_CODE=? and EVENT_NO=?"
	#Dim rset As EnsLib.SQL.GatewayResultSet
	Set qStatus = ..Adapter.ExecuteQuery(.rset,qryString,pInput.OrgCode,pInput.EncounterNumber)
	#Dim pOutput As DataSync.Production.Message.GetExammasterResponse = ##class(DataSync.Production.Message.GetExammasterResponse).%New()
	while rset.Next() {
		#Dim exam As ClinicalDocument.Structure.EXAMMASTER = ##class(ClinicalDocument.Structure.EXAMMASTER).%New()
		set exam.CONCLUSION = rset.%Get("CONCLUSION")
		set exam.EXAMITEMCODE = rset.%Get("EXAM_ITEM_CODE")
		set exam.EXAMITEMNAME = rset.%Get("EXAM_ITEM_NAME")
		set exam.EXAMPERFORMERDTIME = rset.%Get("EXAM_PERFORMER_DTIME")
		set exam.PERFORMERDEPTNAME = rset.%Get("PERFORMER_DEPT_NAME")
		set exam.PERFORMERDOCTOR = rset.%Get("PERFORMER_DOCTOR")
		set exam.REPORTFORMNO = rset.%Get("REPORT_FORM_NO")
		set exam.REPORTTITLE = rset.%Get("REPORT_TITLE")
		Do pOutput.ExammasterList.Insert(exam)
	}
	Quit qStatus
}

/*Method GetExammaster(pInput As DataSync.Production.Message.AddEncounterRequest, Output pOutput As DataSync.Production.Message.GetExammasterResponse) As %Status
{
	Set qryString = "SELECT LAST_UPDATE_DTIME as LASTUPDATEDTIME, ORG_CODE as ORGCODE, REPORT_FORM_NO as REPORTFORMNO, PATIENT_ID as PATIENTID, EVENT_TYPE as EVENTTYPE, EVENT_NO as EVENTNO, RETRIEVE_DATE as RETRIEVEDATE, CLASS_TYPE_CODE as CLASSTYPECODE, CLASS_TYPE_NAME as CLASSTYPENAME, EXAM_SITE_CODE as EXAMSITECODE, EXAM_ITEM_CODE as EXAMITEMCODE, EXAM_ITEM_NAME as EXAMITEMNAME, REPORT_TITLE as REPORTTITLE, EFFECTIVE_DTIME as EFFECTIVEDTIME, CONFIDENTIALITY as CONFIDENTIALITY, NAME as NAME, SEX_CODE as SEXCODE, BIRTH_DATE as BIRTHDATE, AUTHOR_ID as AUTHORID, REPORT_CREATE_DTIME as REPORTCREATEDTIME, AUTHOR_NAME as AUTHORNAME, AUTHENTICATOR_ID as AUTHENTICATORID, AUTHENTICATOR_DTIME as AUTHENTICATORDTIME, AUTHENTICATOR_NAME as AUTHENTICATORNAME, PARTICIPANT_DEPT as PARTICIPANTDEPT, PARTICIPANT_ID as PARTICIPANTID, PARTICIPANT_DTIME as PARTICIPANTDTIME, PARTICIPANT_NAME as PARTICIPANTNAME, ORDER_ID as ORDERID, ORDER_PRIORITY as ORDERPRIORITY, PERFORMER_DEPT_NAME as PERFORMERDEPTNAME, PERFORMER_DOCTOR as PERFORMERDOCTOR, EXAM_PERFORMER_DTIME as EXAMPERFORMERDTIME, OUTPAT_DIAG_NAME as OUTPATDIAGNAME, PATIENT_CONDITION_DESCR as PATIENTCONDITIONDESCR, EXAM_PURPOSE as EXAMPURPOSE, IMAGE_DESCR as IMAGEDESCR, IS_ABNORMAL as ISABNORMAL, CONCLUSION as CONCLUSION, RECOGNITION as RECOGNITION, EXAM_RESULT_CODE as EXAMRESULTCODE, EXAM_QUANTITIVE_RESULT as EXAMQUANTITIVERESULT, QUANTITIVE_UNIT as QUANTITIVEUNIT, SPECIAL_FLAG as SPECIALFLAG, INTERVENTION as INTERVENTION, OPERATION_WAY_DESCR as OPERATIONWAYDESCR, OPERATION_COUNT as OPERATIONCOUNT, ANESTHESIA_CODE as ANESTHESIACODE, ANESTHETIC_OBSERVATION as ANESTHETICOBSERVATION, ANESTHETIC_CLASS_CODE as ANESTHETICCLASSCODE, ANESTHETIC_DOCTOR as ANESTHETICDOCTOR, SPECIMEN_CLASS as SPECIMENCLASS, SPECIMEN_NO as SPECIMENNO, SPECIMEN_STATUS as SPECIMENSTATUS, SPECIMEN_FIXATIVE as SPECIMENFIXATIVE, SPECIMEN_SAMPLE_TIME as SPECIMENSAMPLETIME, SPECIMEN_RECEIVE_TIME as SPECIMENRECEIVETIME, EXAM_TECHNICIAN as EXAMTECHNICIAN, DIAG_DATE as DIAGDATE, CHIEF_COMPLAINTS as CHIEFCOMPLAINTS, SYMPTOM_START_TIME as SYMPTOMSTARTTIME, SYMPTOM_END_TIME as SYMPTOMENDTIME, BARCODE_NO as BARCODENO, EXAM_DEVICE as EXAMDEVICE, EXAM_DEVICE_NAME as EXAMDEVICENAME, REGISTER_TIME as REGISTERTIME, REGISTER_OPERATOR as REGISTEROPERATOR, DIAGNOSE_CODE as DIAGNOSECODE, PRINT_TIME as PRINTTIME, PRINT_OPERATOR as PRINTOPERATOR, RAW_CLASS_TYPE_CODE as RAWCLASSTYPECODE, RAW_CLASS_TYPE_NAME as RAWCLASSTYPENAME, RAW_EXAM_SITE_CODE as RAWEXAMSITECODE, RAW_EXAM_ITEM_CODE as RAWEXAMITEMCODE, RAW_EXAM_ITEM_NAME as RAWEXAMITEMNAME, RAW_SEX_CODE as RAWSEXCODE, RAW_OUTPAT_DIAG_NAME as RAWOUTPATDIAGNAME, RAW_IS_ABNORMAL as RAWISABNORMAL, RAW_RECOGNITION as RAWRECOGNITION, RAW_EXAM_RESULT_CODE as RAWEXAMRESULTCODE, RAW_SPECIAL_FLAG as RAWSPECIALFLAG, RAW_ANESTHESIA_CODE as RAWANESTHESIACODE, RAW_ANESTHETIC_CLASS_CODE as RAWANESTHETICCLASSCODE, STATE_FLAG as STATEFLAG, DATA_ID as DATAID, PROVINCE_CODE as PROVINCECODE, CITY_CODE as CITYCODE, COUNT_CODE as COUNTCODE, CREATE_NAME as CREATENAME, CREATE_TIME as CREATETIME, ALTER_NAME as ALTERNAME, ALTER_TIME as ALTERTIME, ORG_NAME as ORGNAME, RAW_EXAM_SITE_NAME as RAWEXAMSITENAME, DIAGNOSE_NAME as DIAGNOSENAME FROM INSPUR_JKS_TJ_Document.EXAMMASTER"
	_" where ORG_CODE=? and EVENT_NO=?"
	#Dim rset As EnsLib.SQL.GatewayResultSet
	Set qStatus = ..Adapter.ExecuteQuery(.rset,qryString,pInput.OrgCode,pInput.EncounterNumber)
	#Dim pOutput As DataSync.Production.Message.GetExammasterResponse = ##class(DataSync.Production.Message.GetExammasterResponse).%New()
	while rset.Next() {
		#Dim exam As INSPUR.JKS.TJ.Serials.EXAMMASTER = ##class(INSPUR.JKS.TJ.Serials.EXAMMASTER).%New()
		set exam.LASTUPDATEDTIME = rset.%Get("LASTUPDATEDTIME") 
		set exam.ORGCODE = rset.%Get("ORGCODE") 
		set exam.REPORTFORMNO = rset.%Get("REPORTFORMNO") 
		set exam.PATIENTID = rset.%Get("PATIENTID") 
		set exam.EVENTTYPE = rset.%Get("EVENTTYPE") 
		set exam.EVENTNO = rset.%Get("EVENTNO") 
		set exam.RETRIEVEDATE = rset.%Get("RETRIEVEDATE") 
		set exam.CLASSTYPECODE = rset.%Get("CLASSTYPECODE") 
		set exam.CLASSTYPENAME = rset.%Get("CLASSTYPENAME") 
		set exam.EXAMSITECODE = rset.%Get("EXAMSITECODE") 
		set exam.EXAMITEMCODE = rset.%Get("EXAMITEMCODE") 
		set exam.EXAMITEMNAME = rset.%Get("EXAMITEMNAME") 
		set exam.REPORTTITLE = rset.%Get("REPORTTITLE") 
		set exam.EFFECTIVEDTIME = rset.%Get("EFFECTIVEDTIME") 
		set exam.CONFIDENTIALITY = rset.%Get("CONFIDENTIALITY") 
		set exam.NAME = rset.%Get("NAME") 
		set exam.SEXCODE = rset.%Get("SEXCODE") 
		set exam.BIRTHDATE = rset.%Get("BIRTHDATE") 
		set exam.AUTHORID = rset.%Get("AUTHORID") 
		set exam.REPORTCREATEDTIME = rset.%Get("REPORTCREATEDTIME") 
		set exam.AUTHORNAME = rset.%Get("AUTHORNAME") 
		set exam.AUTHENTICATORID = rset.%Get("AUTHENTICATORID") 
		set exam.AUTHENTICATORDTIME = rset.%Get("AUTHENTICATORDTIME") 
		set exam.AUTHENTICATORNAME = rset.%Get("AUTHENTICATORNAME") 
		set exam.PARTICIPANTDEPT = rset.%Get("PARTICIPANTDEPT") 
		set exam.PARTICIPANTID = rset.%Get("PARTICIPANTID") 
		set exam.PARTICIPANTDTIME = rset.%Get("PARTICIPANTDTIME") 
		set exam.PARTICIPANTNAME = rset.%Get("PARTICIPANTNAME") 
		set exam.ORDERID = rset.%Get("ORDERID") 
		set exam.ORDERPRIORITY = rset.%Get("ORDERPRIORITY") 
		set exam.PERFORMERDEPTNAME = rset.%Get("PERFORMERDEPTNAME") 
		set exam.PERFORMERDOCTOR = rset.%Get("PERFORMERDOCTOR") 
		set exam.EXAMPERFORMERDTIME = rset.%Get("EXAMPERFORMERDTIME") 
		set exam.OUTPATDIAGNAME = rset.%Get("OUTPATDIAGNAME") 
		set exam.PATIENTCONDITIONDESCR = rset.%Get("PATIENTCONDITIONDESCR") 
		set exam.EXAMPURPOSE = rset.%Get("EXAMPURPOSE") 
		set exam.IMAGEDESCR = rset.%Get("IMAGEDESCR") 
		set exam.ISABNORMAL = rset.%Get("ISABNORMAL") 
		set exam.CONCLUSION = rset.%Get("CONCLUSION") 
		set exam.RECOGNITION = rset.%Get("RECOGNITION") 
		set exam.EXAMRESULTCODE = rset.%Get("EXAMRESULTCODE") 
		set exam.EXAMQUANTITIVERESULT = rset.%Get("EXAMQUANTITIVERESULT") 
		set exam.QUANTITIVEUNIT = rset.%Get("QUANTITIVEUNIT") 
		set exam.SPECIALFLAG = rset.%Get("SPECIALFLAG") 
		set exam.INTERVENTION = rset.%Get("INTERVENTION") 
		set exam.OPERATIONWAYDESCR = rset.%Get("OPERATIONWAYDESCR") 
		set exam.OPERATIONCOUNT = rset.%Get("OPERATIONCOUNT") 
		set exam.ANESTHESIACODE = rset.%Get("ANESTHESIACODE") 
		set exam.ANESTHETICOBSERVATION = rset.%Get("ANESTHETICOBSERVATION") 
		set exam.ANESTHETICCLASSCODE = rset.%Get("ANESTHETICCLASSCODE") 
		set exam.ANESTHETICDOCTOR = rset.%Get("ANESTHETICDOCTOR") 
		set exam.SPECIMENCLASS = rset.%Get("SPECIMENCLASS") 
		set exam.SPECIMENNO = rset.%Get("SPECIMENNO") 
		set exam.SPECIMENSTATUS = rset.%Get("SPECIMENSTATUS") 
		set exam.SPECIMENFIXATIVE = rset.%Get("SPECIMENFIXATIVE") 
		set exam.SPECIMENSAMPLETIME = rset.%Get("SPECIMENSAMPLETIME") 
		set exam.SPECIMENRECEIVETIME = rset.%Get("SPECIMENRECEIVETIME") 
		set exam.EXAMTECHNICIAN = rset.%Get("EXAMTECHNICIAN") 
		set exam.DIAGDATE = rset.%Get("DIAGDATE") 
		set exam.CHIEFCOMPLAINTS = rset.%Get("CHIEFCOMPLAINTS") 
		set exam.SYMPTOMSTARTTIME = rset.%Get("SYMPTOMSTARTTIME") 
		set exam.SYMPTOMENDTIME = rset.%Get("SYMPTOMENDTIME") 
		set exam.BARCODENO = rset.%Get("BARCODENO") 
		set exam.EXAMDEVICE = rset.%Get("EXAMDEVICE") 
		set exam.EXAMDEVICENAME = rset.%Get("EXAMDEVICENAME") 
		set exam.REGISTERTIME = rset.%Get("REGISTERTIME") 
		set exam.REGISTEROPERATOR = rset.%Get("REGISTEROPERATOR") 
		set exam.DIAGNOSECODE = rset.%Get("DIAGNOSECODE") 
		set exam.PRINTTIME = rset.%Get("PRINTTIME") 
		set exam.PRINTOPERATOR = rset.%Get("PRINTOPERATOR") 
		set exam.RAWCLASSTYPECODE = rset.%Get("RAWCLASSTYPECODE") 
		set exam.RAWCLASSTYPENAME = rset.%Get("RAWCLASSTYPENAME") 
		set exam.RAWEXAMSITECODE = rset.%Get("RAWEXAMSITECODE") 
		set exam.RAWEXAMITEMCODE = rset.%Get("RAWEXAMITEMCODE") 
		set exam.RAWEXAMITEMNAME = rset.%Get("RAWEXAMITEMNAME") 
		set exam.RAWSEXCODE = rset.%Get("RAWSEXCODE") 
		set exam.RAWOUTPATDIAGNAME = rset.%Get("RAWOUTPATDIAGNAME") 
		set exam.RAWISABNORMAL = rset.%Get("RAWISABNORMAL") 
		set exam.RAWRECOGNITION = rset.%Get("RAWRECOGNITION") 
		set exam.RAWEXAMRESULTCODE = rset.%Get("RAWEXAMRESULTCODE") 
		set exam.RAWSPECIALFLAG = rset.%Get("RAWSPECIALFLAG") 
		set exam.RAWANESTHESIACODE = rset.%Get("RAWANESTHESIACODE") 
		set exam.RAWANESTHETICCLASSCODE = rset.%Get("RAWANESTHETICCLASSCODE") 
		set exam.STATEFLAG = rset.%Get("STATEFLAG") 
		set exam.DATAID = rset.%Get("DATAID") 
		set exam.PROVINCECODE = rset.%Get("PROVINCECODE") 
		set exam.CITYCODE = rset.%Get("CITYCODE") 
		set exam.COUNTCODE = rset.%Get("COUNTCODE") 
		set exam.CREATENAME = rset.%Get("CREATENAME") 
		set exam.CREATETIME = rset.%Get("CREATETIME") 
		set exam.ALTERNAME = rset.%Get("ALTERNAME") 
		set exam.ALTERTIME = rset.%Get("ALTERTIME") 
		set exam.ORGNAME = rset.%Get("ORGNAME") 
		set exam.RAWEXAMSITENAME = rset.%Get("RAWEXAMSITENAME") 
		set exam.DIAGNOSENAME = rset.%Get("DIAGNOSENAME")
		Do pOutput.ExammasterList.Insert(exam)
	}
	Quit qStatus
}*/
XData MessageMap
{
<MapItems>
    <MapItem MessageType="DataSync.Production.Message.AddEncounterRequest">
        <Method>GetExammaster</Method>
    </MapItem>
</MapItems>
}

}
